import{_ as I,f as m,o as l,c as d,b as e,w as b,v as M,d as u,p as y,e as A,r as f,g as c,t as p,h as $,i as g,j as S}from"./index-BCrCh3O-.js";import{S as C}from"./SelectGenre-bSW_1pll.js";const w={name:"CreateArtist",components:{SelectGenre:C},data(){return{artistImage:null,artistName:""}},computed:{currentTime(){return new Date().toISOString().slice(0,16)}},methods:{onMounted(){this.imgInputPreview()},imgInputPreview(){const t=document.getElementById("imageInput"),s=document.getElementById("imagePreview");t.addEventListener("change",a=>{this.artistImage=a.target.files[0],s.src=URL.createObjectURL(this.artistImage)})},createArtist(){this.artistImage&&this.artistName&&this.sendCreateArtistRequest().then(this.displayCreatedArtist).then(t=>{this.changeUserAccessToken(t.data.access_token),this.hideModal()})},sendCreateArtistRequest(){const t=this.makeFormData();return m.post("http://music.local/api/artists/create-artist",t)},makeFormData(){const t=new FormData;return t.append("name",this.artistName),t.append("photo",this.artistImage),t},hideModal(){this.$parent.hideModal("createArtistModalOverlay","createArtistModal")()},displayCreatedArtist(t){const s=t.data.artistId;return new Promise(a=>{const r=`http://music.local/api/artists/${s}`;m.get(r).then(o=>{const i=o.data;this.$parent.$data.artist=i,this.$parent.$data.photoSrc=`http://music.local:9005/photo/${i.photoPath}`,a(t)})})},changeUserAccessToken(t){localStorage.removeItem("access_token"),localStorage.setItem("access_token",t)}}},_=t=>(y("data-v-ffd37cb4"),t=t(),A(),t),P={class:"create-artist"},x=_(()=>e("div",{class:"title"}," Создать артиста ",-1)),N={class:"input-fields-container"},D={class:"select-name"},T=_(()=>e("label",{for:"nameInput",class:"input-name-label"},"Выберите имя",-1)),U=_(()=>e("div",{class:"select-image"},[e("label",{for:"imageInput",class:"input-image-label"},"Выбрать обложку"),e("input",{id:"imageInput",type:"file",accept:"image/png"}),e("img",{id:"imagePreview",class:"image-preview"})],-1));function E(t,s,a,r,o,i){return l(),d("div",P,[x,e("div",N,[e("div",D,[T,b(e("input",{id:"nameInput","onUpdate:modelValue":s[0]||(s[0]=h=>o.artistName=h),type:"text",class:"input-name"},null,512),[[M,o.artistName]])]),U]),e("div",{onClick:s[1]||(s[1]=u(h=>i.createArtist(),["prevent"])),class:"submit-button"}," Создать ")])}const L=I(w,[["render",E],["__scopeId","data-v-ffd37cb4"]]),q={name:"Account",components:{CreateArtist:L},data(){return{personalInfo:null,artist:null,imageError:null,photoSrc:null}},mounted(){this.getPersonalInfo().then(this.getArtistInfo)},methods:{getPersonalInfo(){return m.get("http://music.local/api/auth/me").then(t=>{this.personalInfo=t.data})},getArtistInfo(){this.personalInfo.artistId&&m.get(`http://music.local/api/artists/${this.personalInfo.artistId}`).then(t=>{this.artist=t.data,this.photoSrc=`http://music.local:9005/photo/${this.artist.photoPath}`})},openModalCreateArtist(){this.$refs.createArtistRef.onMounted(),this.openModal("createArtistModalOverlay","createArtistModal")},openModal(t,s){const a=document.querySelector(`#${s}`);a.style.visibility="visible",a.style.opacity="1",setTimeout(()=>{this.overlayClickListener(t,s)},500)},overlayClickListener(t,s){document.querySelector(`#${t}`).addEventListener("click",this.hideModal(t,s))},hideModal(t,s){return()=>{const a=document.querySelector(`#${t}`),r=document.querySelector(`#${s}`);r.style.visibility="hidden",r.style.opacity="0",a.removeEventListener("click",this.hideModal(t,s))}},logoutUser(){m.post("http://music.local/api/auth/logout").then(t=>{localStorage.removeItem("access_token"),this.$router.push({name:"auth.login"})})}}},n=t=>(y("data-v-7f954fab"),t=t(),A(),t),R={class:"accounts-container"},B={class:"user-account"},O=n(()=>e("div",{class:"title"},"Мои данные",-1)),V={key:0,class:"personal-info"},F={class:"personal-name"},j=n(()=>e("span",null,[e("strong",null,"Имя:")],-1)),G={class:"personal-email"},z=n(()=>e("span",null,[e("strong",null,"Почта:")],-1)),H={class:"artist-account"},J=n(()=>e("div",{class:"title"},"Аккаунт артиста",-1)),K={key:0},Q={class:"artist-card select-none"},W={class:"artist-photo-container"},X=["src"],Y={class:"artist-info"},Z={key:1},tt={class:"create-artist-box"},et=n(()=>e("div",{class:"create-artist-title"},"У вас нет аккаунта артиста",-1)),st=n(()=>e("br",null,null,-1)),at={class:"modal",id:"createArtistModal"},ot=n(()=>e("div",{class:"modal-overlay",id:"createArtistModalOverlay"},null,-1)),it={class:"modal-window"};function nt(t,s,a,r,o,i){const h=f("router-link"),k=f("create-artist");return l(),d("div",R,[e("div",B,[O,o.personalInfo?(l(),d("div",V,[e("div",F,[j,c(" "+p(o.personalInfo.name),1)]),e("div",G,[z,c(" "+p(o.personalInfo.email),1)])])):$("",!0),e("div",{class:"submit-button danger",onClick:s[0]||(s[0]=u((...v)=>i.logoutUser&&i.logoutUser(...v),["prevent"]))}," Выйти ")]),e("div",H,[J,o.artist?(l(),d("div",K,[e("div",Q,[e("div",W,[e("img",{class:"artist-photo",src:o.photoSrc},null,8,X)]),e("div",Y,[g(h,{to:{name:"artist.single",params:{id:o.artist.id}},class:"artist-info__name"},{default:S(()=>[c(p(o.artist.name),1)]),_:1},8,["to"])])])])):(l(),d("div",Z,[e("div",tt,[et,e("div",{onClick:s[1]||(s[1]=u(v=>i.openModalCreateArtist(),["prevent"])),class:"submit-button"},[c(" Создать"),st,c(" аккаунт артиста ")])])]))]),e("div",at,[ot,e("div",it,[g(k,{ref:"createArtistRef"},null,512)])])])}const lt=I(q,[["render",nt],["__scopeId","data-v-7f954fab"]]);export{lt as default};
