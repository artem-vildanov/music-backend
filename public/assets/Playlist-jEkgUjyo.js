import{_ as u,f as n,o as r,c as h,b as e,d as p,p as _,e as v,g,r as m,w as M,v as f,i as $,F as b,t as w,k,h as S,l as C}from"./index-BCrCh3O-.js";import{S as D}from"./SongCard-nZr3fhIa.js";import{_ as N}from"./edit-CJGwvuct.js";import"./PlaylistCard--LevWLeD.js";import"./not_liked-CjpSLIKd.js";const E={name:"DeletePlaylist",props:["playlist"],methods:{deletePlaylist(){const t=`http://music.local/api/playlists/${this.playlist.id}/delete-playlist`;n.delete(t).then(this.redirectToAllPlaylists)},closeDeletePlaylistModal(){this.$parent.hideDeletePlaylistModal("deletePlaylistModalOverlay","deletePlaylistModal")()},redirectToAllPlaylists(){const t={name:"playlist.all"};this.$router.push(t)}}},L=t=>(_("data-v-aa4b2817"),t=t(),v(),t),x={class:"confirmation-box"},q=L(()=>e("div",{class:"title"},[g(" Вы уверены, что хотите"),e("br"),g(" удалить этот плейлист? ")],-1)),O={class:"buttons-container"};function U(t,l,s,o,i,a){return r(),h("div",x,[q,e("div",O,[e("div",{onClick:l[0]||(l[0]=p(d=>a.deletePlaylist(),["prevent"])),class:"submit-button danger"}," Удалить "),e("div",{onClick:l[1]||(l[1]=p(d=>a.closeDeletePlaylistModal(),["prevent"])),class:"submit-button"}," Отмена ")])])}const B=u(E,[["render",U],["__scopeId","data-v-aa4b2817"]]),T={name:"EditPlaylist",components:{DeletePlaylist:B},data(){return{photoSrc:`http://music.local:9005/photo/${this.playlist.photoPath}`,playlistImage:null,oldPlaylistName:this.playlist.name,newPlaylistName:"",selectedGenre:null}},props:["playlist"],methods:{onMounted(){this.imgInputPreview()},imgInputPreview(){const t=document.getElementById("imgInput"),l=document.getElementById("imagePreview");t.addEventListener("change",s=>{this.playlistImage=s.target.files[0],l.src=URL.createObjectURL(this.playlistImage)})},buttonClickabilityChecker(){return this.playlistImage!==null||this.newPlaylistName!==""},async editPlaylist(){await this.editPlaylistName(),await this.editPlaylistImage(),await this.displayUpdatedPlaylist(),this.hideModal()},async editPlaylistName(){if(this.newPlaylistName){const t=`http://music.local/api/playlists/${this.playlist.id}/update-playlist-name`,l={name:this.newPlaylistName};await n.post(t,l)}},async editPlaylistImage(){if(this.playlistImage){const t=`http://music.local/api/playlists/${this.playlist.id}/update-playlist-photo`,l=this.makeImageFormData();await n.post(t,l)}},makeImageFormData(){const t=new FormData;return t.append("photo",this.playlistImage),t},async displayUpdatedPlaylist(){const l=(await this.getUpdatedPlaylist()).data;this.$parent.$data.playlist=l,this.$parent.$data.photoSrc=`http://music.local:9005/photo/${l.photoPath}`},getUpdatedPlaylist(){const t=`http://music.local/api/playlists/${this.playlist.id}`;return n.get(t)},hideModal(){this.$parent.hideModal("editPlaylistModalOverlay","editPlaylistModal")()},deletePlaylist(){this.openDeletePlaylistModal("deletePlaylistModalOverlay","deletePlaylistModal")},openDeletePlaylistModal(t,l){const s=document.querySelector(`#${l}`);s.style.visibility="visible",s.style.opacity="1",setTimeout(()=>{this.overlayClickListener(t,l)},500)},overlayClickListener(t,l){document.querySelector(`#${t}`).addEventListener("click",this.hideDeletePlaylistModal(t,l))},hideDeletePlaylistModal(t,l){return()=>{const s=document.querySelector(`#${t}`),o=document.querySelector(`#${l}`);o.style.visibility="hidden",o.style.opacity="0",s.removeEventListener("click",this.hideDeletePlaylistModal(t,l))}}}},y=t=>(_("data-v-c9a705a8"),t=t(),v(),t),F={class:"edit-playlist"},R=y(()=>e("div",{class:"title"}," Изменить плейлист ",-1)),V={class:"input-fields-container"},j={class:"select-name"},A=y(()=>e("label",{for:"playlistNameInput",class:"input-name-label"},"Введите имя плейлиста",-1)),G=["placeholder"],z={class:"select-image"},H=y(()=>e("label",{for:"imgInput",class:"input-image-label"},"Выбрать обложку",-1)),J=y(()=>e("input",{id:"imgInput",type:"file",accept:"image/png"},null,-1)),K=["src"],Q={class:"buttons-container"},W=["disabled"],X={class:"modal",id:"deletePlaylistModal"},Y=y(()=>e("div",{class:"modal-overlay",id:"deletePlaylistModalOverlay"},null,-1)),Z={class:"modal-window"};function tt(t,l,s,o,i,a){const d=m("delete-playlist");return r(),h(b,null,[e("div",F,[R,e("div",V,[e("div",j,[A,M(e("input",{id:"playlistNameInput",placeholder:i.oldPlaylistName,"onUpdate:modelValue":l[0]||(l[0]=c=>i.newPlaylistName=c),type:"text",class:"input-name"},null,8,G),[[f,i.newPlaylistName]])]),e("div",z,[H,J,e("img",{id:"imagePreview",src:i.photoSrc,class:"image-preview"},null,8,K)])]),e("div",Q,[e("input",{type:"submit",disabled:!a.buttonClickabilityChecker(),onClick:l[1]||(l[1]=p(c=>a.editPlaylist(),["prevent"])),class:"submit-button",value:"Изменить"},null,8,W),e("div",{onClick:l[2]||(l[2]=p(c=>a.deletePlaylist(),["prevent"])),class:"submit-button danger"}," Удалить ")])]),e("div",X,[Y,e("div",Z,[$(d,{playlist:s.playlist},null,8,["playlist"])])])],64)}const lt=u(T,[["render",tt],["__scopeId","data-v-c9a705a8"]]),et={name:"Playlist",components:{EditPlaylist:lt,SongCard:D},data(){return{playlistId:null,playlist:null,songsCollection:null,photoSrc:null}},mounted(){this.playlistId=this.$route.params.id,this.getPlaylist(),this.getPlaylistSongs()},methods:{getPlaylist(){const t=`http://music.local/api/playlists/${this.playlistId}`;n.get(t).then(l=>{this.playlist=l.data,this.photoSrc=`http://music.local:9005/photo/${this.playlist.photoPath}`})},getPlaylistSongs(){const t=`http://music.local/api/playlists/${this.playlistId}/playlist-songs`;n.get(t).then(l=>{this.songsCollection=l.data})},openEditPlaylistModal(){this.$refs.editPlaylistRef.onMounted(),this.openModal("editPlaylistModalOverlay","editPlaylistModal")},openModal(t,l){const s=document.querySelector(`#${l}`);s.style.visibility="visible",s.style.opacity="1",setTimeout(()=>{this.overlayClickListener(t,l)},500)},overlayClickListener(t,l){document.querySelector(`#${t}`).addEventListener("click",this.hideModal(t,l))},hideModal(t,l){return()=>{const s=document.querySelector(`#${l}`),o=document.querySelector(`#${t}`);s.style.visibility="hidden",s.style.opacity="0",o.removeEventListener("click",this.hideModal(t,l))}}}},I=t=>(_("data-v-fb0dabbf"),t=t(),v(),t),st={key:0,class:"playlist"},it={class:"playlist-info"},at={class:"photo-container"},ot=["src"],nt={class:"info-container"},dt={class:"playlist-name"},ct={class:"playlist-actions-container"},rt=I(()=>e("img",{class:"icon select-none",src:N},null,-1)),pt=[rt],yt={class:"playlist-songs"},ht={class:"modal",id:"editPlaylistModal"},mt=I(()=>e("div",{class:"modal__overlay",id:"editPlaylistModalOverlay"},null,-1)),ut={class:"modal__window"};function _t(t,l,s,o,i,a){const d=m("song-card"),c=m("edit-playlist");return i.playlist?(r(),h("div",st,[e("div",it,[e("div",at,[e("img",{class:"playlist-photo select-none",src:i.photoSrc},null,8,ot)]),e("div",nt,[e("div",dt,w(i.playlist.name),1),e("div",ct,[e("div",{onClick:l[0]||(l[0]=p(P=>a.openEditPlaylistModal(),["prevent"])),class:"playlist-action"},pt)])])]),e("div",yt,[(r(!0),h(b,null,k(i.songsCollection,P=>(r(),C(d,{songProps:P},null,8,["songProps"]))),256))]),e("div",ht,[mt,e("div",ut,[$(c,{ref:"editPlaylistRef",playlist:i.playlist},null,8,["playlist"])])])])):S("",!0)}const It=u(et,[["render",_t],["__scopeId","data-v-fb0dabbf"]]);export{It as default};
