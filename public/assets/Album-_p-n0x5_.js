import{_ as A,f as n,o as b,c as I,b as s,d,p as $,e as S,g as v,r as h,w as c,v as C,i as g,n as r,F as w,q as T,t as y,j as D,k as F,h as N,l as E}from"./index-BCrCh3O-.js";import{S as L}from"./SongCard-nZr3fhIa.js";import{S as q}from"./SelectGenre-bSW_1pll.js";import{_ as x,a as G}from"./not_liked-CjpSLIKd.js";import{_ as O}from"./edit-CJGwvuct.js";import{_ as U}from"./create-CM7SjTAk.js";import"./PlaylistCard--LevWLeD.js";const R={name:"DeleteAlbum",props:["album"],methods:{deleteAlbum(){const e=`http://music.local/api/albums/${this.album.id}/delete-album`;n.delete(e).then(this.redirectToArtist)},closeDeleteAlbumModal(){this.$parent.hideDeleteAlbumModal("deleteAlbumModalOverlay","deleteAlbumModal")()},redirectToArtist(){const e={name:"artist.single",params:{id:this.album.artistId}};this.$router.push(e)}}},B=e=>($("data-v-e304950a"),e=e(),S(),e),V={class:"confirmation-box"},j=B(()=>s("div",{class:"title"},[v(" Вы уверены, что хотите"),s("br"),v(" удалить этот альбом? ")],-1)),H={class:"buttons-container"};function z(e,t,l,i,o,a){return b(),I("div",V,[j,s("div",H,[s("div",{onClick:t[0]||(t[0]=d(u=>a.deleteAlbum(),["prevent"])),class:"submit-button danger"}," Удалить "),s("div",{onClick:t[1]||(t[1]=d(u=>a.closeDeleteAlbumModal(),["prevent"])),class:"submit-button"}," Отмена ")])])}const J=A(R,[["render",z],["__scopeId","data-v-e304950a"]]),K={name:"EditAlbum",components:{SelectGenre:q,DeleteAlbum:J},data(){return{photoSrc:`http://music.local:9005/photo/${this.album.photoPath}`,albumImage:null,oldAlbumName:this.album.name,newAlbumName:"",selectedGenre:null,albumPublishTime:null}},props:["album"],methods:{onMounted(){this.imgInputPreview(),this.$refs.selectGenreRef.onMounted()},publishTimeChangeHandler(){const e=document.getElementById("createPublishTime");this.albumPublishTime=e.value},imgInputPreview(){const e=document.getElementById("imgInput"),t=document.getElementById("imagePreview");e.addEventListener("change",l=>{this.albumImage=l.target.files[0],t.src=URL.createObjectURL(this.albumImage)})},editAlbum(){this.selectedGenre=this.getSelectedGenreId(),(this.albumImage||this.newAlbumName||this.albumPublishTime)&&this.editAlbumNameAndGenre().then(this.editAlbumImage).then(this.editAlbumPublishTime).then(this.displayUpdatedAlbum).then(this.hideModal)},editAlbumNameAndGenre(){return new Promise(e=>{if(this.newAlbumName){const t=`http://music.local/api/albums/${this.album.id}/update-album-name-genre`,l={name:this.newAlbumName,genreId:this.selectedGenre};n.post(t,l).then(e)}else e()})},editAlbumImage(){return new Promise(e=>{if(this.albumImage){const t=`http://music.local/api/albums/${this.album.id}/update-album-photo`,l=this.makeImageFormData();n.post(t,l).then(e)}else e()})},editAlbumPublishTime(){return new Promise(e=>{if(this.albumPublishTime){const t=`http://music.local/api/albums/${this.album.id}/update-album-publish-time`,l={publishTime:this.albumPublishTime};n.post(t,l).then(e)}else e()})},displayUpdatedAlbum(){return new Promise(e=>{this.getUpdatedAlbum().then(t=>{const l=t.data;this.$parent.$data.album=l,this.updateAlbumImage(l.photoPath),e()})})},updateAlbumImage(e){if(this.albumImage){const t=`http://music.local:9005/photo/${e}`;this.$parent.$data.photoSrc=t,document.querySelectorAll(".song-photo").forEach(i=>{i.src=t})}},getUpdatedAlbum(){const e=`http://music.local/api/albums/${this.album.id}`;return n.get(e)},makeImageFormData(){const e=new FormData;return e.append("photo",this.albumImage),e},getSelectedGenreId(){const e=document.getElementsByName("genre");let t;for(var l=0;l<e.length;l++)if(e[l].checked){t=e[l].value;break}if(!t)throw Error("genre is not selected");return t},hideModal(){this.$parent.hideModal("editAlbumModalOverlay","editAlbumModal")()},deleteAlbum(){this.openDeleteAlbumModal("deleteAlbumModalOverlay","deleteAlbumModal")},openDeleteAlbumModal(e,t){const l=document.querySelector(`#${t}`);l.style.visibility="visible",l.style.opacity="1",setTimeout(()=>{this.overlayClickListener(e,t)},500)},overlayClickListener(e,t){document.querySelector(`#${e}`).addEventListener("click",this.hideDeleteAlbumModal(e,t))},hideDeleteAlbumModal(e,t){return()=>{const l=document.querySelector(`#${e}`),i=document.querySelector(`#${t}`);i.style.visibility="hidden",i.style.opacity="0",l.removeEventListener("click",this.hideDeleteAlbumModal(e,t))}}}},p=e=>($("data-v-454c196e"),e=e(),S(),e),Q={class:"edit-album"},W=p(()=>s("div",{class:"title"}," Изменить альбом ",-1)),X={class:"input-fields-container"},Y={class:"select-genre-and-name"},Z={class:"select-name"},ee=p(()=>s("label",{for:"nameInput",class:"input-name-label"},"Выберите имя",-1)),te=["placeholder"],se={class:"select-genre"},le={class:"select-image-and-publish-time"},oe={class:"select-image"},ae=p(()=>s("label",{for:"imgInput",class:"input-image-label"},"Выбрать обложку",-1)),ie=p(()=>s("input",{id:"imgInput",type:"file",accept:"image/png"},null,-1)),ne=["src"],de={class:"select-publish-time"},ue=p(()=>s("label",{for:"createPublishTime"},"Выберите время публикации альбома: ",-1)),ce=["value","min"],me={class:"buttons-container"},re={class:"modal",id:"deleteAlbumModal"},he=p(()=>s("div",{class:"modal-overlay",id:"deleteAlbumModalOverlay"},null,-1)),be={class:"modal-window"};function pe(e,t,l,i,o,a){const u=h("select-genre"),M=h("delete-album");return b(),I(w,null,[s("div",Q,[W,s("div",X,[s("div",Y,[s("div",Z,[ee,c(s("input",{id:"nameInput",placeholder:o.oldAlbumName,"onUpdate:modelValue":t[0]||(t[0]=m=>o.newAlbumName=m),type:"text",class:"input-name"},null,8,te),[[C,o.newAlbumName]])]),s("div",se,[g(u,{ref:"selectGenreRef",preSelectedGenreId:l.album.genreId},null,8,["preSelectedGenreId"])])]),s("div",le,[s("div",oe,[ae,ie,s("img",{id:"imagePreview",src:o.photoSrc,class:"image-preview"},null,8,ne)]),c(s("div",de,[ue,s("input",{onChange:t[1]||(t[1]=(...m)=>a.publishTimeChangeHandler&&a.publishTimeChangeHandler(...m)),type:"datetime-local",id:"createPublishTime",value:l.album.publishTime,min:l.album.publishTime},null,40,ce)],512),[[r,l.album.publishTime]])])]),s("div",me,[s("div",{onClick:t[2]||(t[2]=d(m=>a.editAlbum(),["prevent"])),class:"submit-button"}," Изменить "),s("div",{onClick:t[3]||(t[3]=d(m=>a.deleteAlbum(),["prevent"])),class:"submit-button danger"}," Удалить ")])]),s("div",re,[he,s("div",be,[g(M,{album:l.album},null,8,["album"])])])],64)}const _e=A(K,[["render",pe],["__scopeId","data-v-454c196e"]]),ve={name:"CreateSong",data(){return{songName:"",audioFile:null,albumId:this.$parent.albumId}},mounted(){this.audioInputPreview()},methods:{buttonClickabilityChecker(){return this.songName!==""&&this.audioFile!==null},audioInputPreview(){const e=document.querySelector("#audioPlayer");document.querySelector("#audioInput").addEventListener("change",l=>{this.audioFile=l.target.files[0],e.src=URL.createObjectURL(this.audioFile)})},async createSong(){const e=await this.sendCreateSongRequest();await this.displayCreatedSong(e),this.hideModal()},makeFormData(){const e=new FormData;return e.append("name",this.songName),e.append("music",this.audioFile),e},async sendCreateSongRequest(){const e=this.makeFormData(),t=`http://music.local/api/albums/${this.albumId}/songs/create-song`;return(await n.post(t,e)).data},async displayCreatedSong(e){const t=`http://music.local/api/albums/${this.albumId}/songs/${e}`,i=(await n.get(t)).data;this.$parent.$data.songsCollection.push(i)},hideModal(){this.$parent.hideModal("createSongModalOverlay","createSongModal")()}}},k=e=>($("data-v-457715f6"),e=e(),S(),e),ge={class:"create-song"},Ie=k(()=>s("div",{class:"title"},"Создать песню",-1)),fe={class:"input-fields-container"},ye={class:"change-name"},Ae=k(()=>s("div",null,"Выберите имя",-1)),$e=T('<div class="change-audio" data-v-457715f6><label for="audioInput" class="input-audio-label" data-v-457715f6>Выбрать аудио файл</label><input id="audioInput" type="file" accept="audio/mpeg" class="input-audio" data-v-457715f6></div><div class="audio-preview" data-v-457715f6><audio controls id="audioPlayer" data-v-457715f6></audio></div>',2),Se=["disabled"];function Me(e,t,l,i,o,a){return b(),I("div",ge,[Ie,s("div",fe,[s("div",ye,[Ae,c(s("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>o.songName=u),type:"text",class:"input-name"},null,512),[[C,o.songName]])]),$e]),s("input",{type:"submit",value:"Создать",disabled:!a.buttonClickabilityChecker(),onClick:t[1]||(t[1]=d(u=>a.createSong(),["prevent"])),class:"submit-button"},null,8,Se)])}const Ce=A(ve,[["render",Me],["__scopeId","data-v-457715f6"]]),we={name:"Album",components:{SongCard:L,EditAlbum:_e,CreateSong:Ce},data(){return{imageError:!1,albumId:this.$route.params.id,album:null,songsCollection:null,photoSrc:null,userInfo:null}},mounted(){this.getAlbum(),this.getAlbumSongs(),this.getUserInfo()},methods:{getAlbum(){const e=`http://music.local/api/albums/${this.albumId}`;n.get(e).then(t=>{this.album=t.data,this.photoSrc=`http://music.local:9005/photo/${this.album.photoPath}`})},getAlbumSongs(){const e=`http://music.local/api/albums/${this.albumId}/songs/album-songs`;n.get(e).then(t=>{this.songsCollection=t.data})},getUserInfo(){n.get("http://music.local/api/auth/me").then(t=>{this.userInfo=t.data})},openCreateSongModal(){this.openModal("createSongModalOverlay","createSongModal")},openEditAlbumModal(){this.$refs.editAlbumRef.onMounted(),this.openModal("editAlbumModalOverlay","editAlbumModal")},openModal(e,t){const l=document.querySelector(`#${t}`);l.style.visibility="visible",l.style.opacity="1",setTimeout(()=>{this.overlayClickListener(e,t)},500)},overlayClickListener(e,t){document.querySelector(`#${e}`).addEventListener("click",this.hideModal(e,t))},hideModal(e,t){return()=>{const l=document.querySelector(`#${t}`),i=document.querySelector(`#${e}`);l.style.visibility="hidden",l.style.opacity="0",i.removeEventListener("click",this.hideModal(e,t))}},addToFavourites(){n.put(`http://music.local/api/favourite/albums/add-to-favourites/${this.album.id}`),this.album.isFavourite=!0},removeFromFavourites(){n.put(`http://music.local/api/favourite/albums/delete-from-favourites/${this.album.id}`),this.album.isFavourite=!1}}},f=e=>($("data-v-62fd87ac"),e=e(),S(),e),ke={key:0,class:"album"},Pe={class:"album-info"},Te={class:"photo-container"},De=["src"],Fe={class:"info-container"},Ne={class:"album-name"},Ee={class:"genre-name"},Le={class:"publish-time"},qe=f(()=>s("br",null,null,-1)),xe={class:"album-actions-container"},Ge={class:"album-action"},Oe=f(()=>s("img",{class:"icon select-none",src:O},null,-1)),Ue=[Oe],Re=f(()=>s("img",{class:"icon select-none",src:U},null,-1)),Be=[Re],Ve={class:"album-songs"},je={class:"modal",id:"editAlbumModal"},He=f(()=>s("div",{class:"modal__overlay",id:"editAlbumModalOverlay"},null,-1)),ze={class:"modal__window"},Je={class:"modal",id:"createSongModal"},Ke=f(()=>s("div",{class:"modal__overlay",id:"createSongModalOverlay"},null,-1)),Qe={class:"modal__window"};function We(e,t,l,i,o,a){const u=h("router-link"),M=h("song-card"),m=h("edit-album"),P=h("create-song");return o.album?(b(),I("div",ke,[s("div",Pe,[s("div",Te,[s("img",{class:"album-photo select-none",src:o.photoSrc},null,8,De)]),s("div",Fe,[s("div",Ne,y(o.album.name),1),g(u,{to:{name:"artist.single",params:{id:o.album.artistId}},class:"artist-name"},{default:D(()=>[v(y(o.album.artistName),1)]),_:1},8,["to"]),s("div",Ee,y(o.album.genreName),1),c(s("div",Le,[v(" Альбом будет опубликован: "),qe,v(" "+y(o.album.publishTime),1)],512),[[r,o.album.publishTime]]),s("div",xe,[s("div",Ge,[c(s("img",{onClick:t[0]||(t[0]=d(_=>a.removeFromFavourites(),["prevent"])),class:"icon select-none",src:x},null,512),[[r,o.album.isFavourite]]),c(s("img",{onClick:t[1]||(t[1]=d(_=>a.addToFavourites(),["prevent"])),class:"icon select-none",src:G},null,512),[[r,!o.album.isFavourite]])]),c(s("div",{onClick:t[2]||(t[2]=d(_=>a.openEditAlbumModal(),["prevent"])),class:"album-action"},Ue,512),[[r,o.userInfo&&o.album.artistId===o.userInfo.artistId]]),c(s("div",{onClick:t[3]||(t[3]=d(_=>a.openCreateSongModal(),["prevent"])),class:"album-action"},Be,512),[[r,o.userInfo&&o.album.artistId===o.userInfo.artistId]])])])]),s("div",Ve,[(b(!0),I(w,null,F(o.songsCollection,_=>(b(),E(M,{songProps:_},null,8,["songProps"]))),256))]),s("div",je,[He,s("div",ze,[g(m,{ref:"editAlbumRef",album:o.album},null,8,["album"])])]),s("div",Je,[Ke,s("div",Qe,[g(P)])])])):N("",!0)}const ot=A(we,[["render",We],["__scopeId","data-v-62fd87ac"]]);export{ot as default};
